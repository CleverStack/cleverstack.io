<h3 class="page-header" id="backend-controllers">
  Controllers <br>
  <small>Lightning-fast and flexible controller prototype</small>
</h3>
<p class="lead">The main aim of the controller is to help simplify the most common tasks that you need to do when setting up routes and functions/classes to handle them.</p>

<h5>Features</h5>
<ul>
  <li>Lightning fast</li>
  <li>V8's Hidden Classes & Inline Caches</li>
  <li>V8's Optimizing Compiler which generates efficient machine code to run in place of your javascript</li>
  <li>Clean, Efficient and Optimized code</li>
  <li>Super methods</li>
  <li>Static inheritance</li>
  <li>Prototypal inheritance</li>
  <li>Setup and initialization methods for both Static and Prototype</li>
  <li>Easy-to-use method proxys with currying ( Static.callback() and Prototype.proxy() )</li>
  <li>Internet Addressable functions, simply add 'Action' to the end of your controllers method() name and it will be Internet Addressable (as long as a route points to that controller).</li>
  <li>Private functions, any function without 'Action' on the end of its name is NOT Internet Addressable</li>
  <li>Easy accessors for Request and Response, available as this.req and this.res.</li>
</ul>
<br>

<!-- Introduction
================================================== -->
<h4 id="background-controllers-introduction" class="page-header">Introduction</h4>
<p>Controllers are the thing that directly responds to each HTTP Request that comes into your application, as such each web request will result in (if routed) a new instance of a Controller (Class).</p>
<p>Avoid callback soup/hell and promise slowdown by using this.proxy() or this.callback() in the Static section of the Controller, this keeps code nesting to a minimum and brings code re-use up. Instead of passing around req and res as arguments like other less organized solutions, in CleverStack they are exposed as this.req and this.res</p>
<br>

<!-- Options
================================================== -->
<h4 id="backend-controllers-options" class="page-header">Options</h4>
<p>You define any options along with the Prototype section of your Controller.extend() call</p>
<table class="table table-bordered table-striped">
  <thead>
  <tr>
      <th style="width: 100px;">Property</th>
      <th style="width: 150px;">Type/s</th>
      <th style="width: 50px;">Default</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
      <td>service</td>
      <td>boolean | Model</td>
      <td>false</td>
      <td>If set to a CleverStack Model it will provide automatic CRUD routing using restfulActions and/or actionRouting</td>
  </tr>
  </tbody>
</table>
<br>

<!-- Definition
================================================== -->
<h4 id="backend-controllers-definition" class="page-header">Definition</h4>
{% highlight javascript %}
module.exports = ExampleController = function() {
    return Controller.extend(
    {
        // example that returns JSON, available from route '/example/hello'
        helloAction: function() {
            this.send({
                message: 'Hi there'
            })
        }
    });
};
{% endhighlight %}
<br>

<!-- Actions
================================================== -->
<h4 id="backend-controllers-actions" class="page-header">Actions</h4>
<p>
  When doing a GET /example it will route to either listAction first OR getAction if listAction is not defined.<br>
  If neither are defined, express's .next() function will be called allowing it to fall through the controller and move onto any other middleware you may have configured.<br>
  If you want /example/hello as a route, you can simply implement helloAction in your controller and it will be automatically routed to it.
</p>
<div class="bs-callout bs-callout-info">
  <h4>Standard for defining actions</h4>
  <p>This is the default way to setup a controller to use actions. By default you can also visit /example/12 and it will route to the getAction function in your controller (if it's defined) with this.req.params.id set for you to use (the same applies for all HTTP methods, eg PUT/DELETE/POST/et cetera)</p>
</div>
<br>

<!-- Middleware
================================================== -->
<h4 id="backend-controllers-middleware" class="page-header">Middleware</h4>
{% highlight javascript %}
module.exports = ExampleController = function() {
    return Controller.extend(
    {
        someMiddleware: function(req, res, next) {
            res.send({
                message: 'Hi from middleware!'
            });
        }
    },
    {
        // example that returns JSON, available from route '/example/hello'
        helloAction: function() {
            this.send({
                message: 'Hi there'
            })
        }
    });
};
{% endhighlight %}
<br>

<!-- Routing
================================================== -->
<h4 id="backend-controllers-routing" class="page-header">Routing</h4>
<p>Your modules routes.js file is what defines which Controllers are loaded and added into routes, this example shows the default way you can attach your controller. (Except for Controllers which have autoRoute enabled, those controllers have these routes automatically attached)</p>
{% highlight javascript %}
// modules/backend-example-module/routes.js
module.exports = function( app, ExampleController ) {

  // Restful and Action based routing
  app.all( '/example/:action/:id?', ExampleController.attach() );
  app.all( '/example/?:action?', ExampleController.attach() );

  // Middleware routing
  app.use( ExampleController.someMiddleware );

}
{% endhighlight %}
<p><span class="label label-info">Note</span> This will automatically load the ExampleController's dependencies including Services, Models and any other resources.</p>
<p><span class="label label-info">Note</span> We use ExpressJS as our main web service, so be sure to checkout how to use <a href="http://expressjs.com/api.html#app.VERB">ExpressJS Routes</a></p><br/>

<h5>Automatic Routing ( Class.autoRouting )</h5>
<ul>
  <li>Ability to turn on or off autoRouting (true or array for ON, false for OFF)</li>
  <li>Array notation allows (Connect or any other) Middleware to be attached to the routes that are autoRouted</li>
  <li>Route naming: Ability to either define your own route (name), or have it automatically generated based on the filename of your controller! (ExampleController would have a route name of /example and /examples in a RESTful fashion )</li>
</ul>

Examples:
{% highlight javascript %}
{
    // ...

    autoRouting: [
        // As a String (only available for methods on the controllers Class, either inherited or defined)
        'middlewareFromThisController',

        // Any function
        function definedFunction( req, res, next ) {
            // any function (from any file) that takes these three arguments can be attached
        },

        // CleverStack example
        PermissionController.requiresPermission({
            all: 'Example.$action', // optional: ability to define rules based on action (Example.post for POST, etc)
            postAction: false       // optional: ability to define overrides per action (Overrides must include 'Action')
        })
    ],

    middlewareFromThisController: function( req, res, next ) {
        // Attached inside of autoRouting array
        next();
    }

    // ...
}
{% endhighlight %}
<br>

<h4 id="backend-controllers-examples" class="page-header">Examples</h4>
<p>Coming soon, we are working hard on this section.</p><br>

<h4 id="backend-controllers-testing" class="page-header">Testing</h4>
<p>Coming soon, we are working hard on this section.</p><br>